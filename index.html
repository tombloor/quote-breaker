<html>
    <head>
        <title>Quote Breaker</title>
        <style type='text/css'>
            [v-cloak] { display:none; }
        </style>
    <body>
        <div id='app' v-cloak>
            <button v-on:click='getQuote'>Get a new quote</button>

            <div v-if='loading'>
                <p>Loading a new quote...</p>
            </div>
            
            <div v-else-if='decoded_quote'>
                <h3>Decode the quote!</h3>
                <table>
                    <tr>
                        <td align='center' v-for='(replacement, original, index) in alphabet'>
                            {{original}}
                        </td>
                    </tr>
                    <tr>
                        <td align='center' v-for='(replacement, original, index) in alphabet'>
                            <input type='text' maxlength="1" v-bind:value='replacement' style='width:35px; text-align:center' />
                        </td>
                    </tr>
                </table>
                <p>{{ decoded_quote }}</p>
                <p><i>{{ author }}</i></p>
            </div>
        </div>

        <script type='text/javascript' src="scripts/vue.js"></script> 
        <script type='text/javascript'>
            let quotes_url = 'https://api.quotable.io/random';
            var app = new Vue({
                el: '#app',
                data: {
                    alphabet: {},
                    loading: undefined,
                    decoded_quote: '',
                    encoded: '',
                    author: '',
                    completed: false // Set to true with the user submits the decoded quote sucessfully
                },
                mounted: function() {
                    let a = 'abcdefghijklmnopqrstuvwxyz';
                    let tmp = {}
                    
                    for (let i = 0; i < a.length; i++) {
                        tmp[a[i]] = '';
                    }

                    this.alphabet = tmp;
                },
                methods: {
                    getQuote: async function() {
                        this.loading = true;

                        let q = await this._requestQuote();
                        this.decoded_quote = q.quote;
                        this.author = q.author;

                        for (let i in this.alphabet) {
                            this.alphabet[i] = '';
                        }
                        
                        this.loading = false;
                    },
                    _requestQuote: async function() {
                        let response = await fetch(quotes_url);
                        if(response.ok) {
                            quote_json = await response.json();
                            return {
                                quote: quote_json.content,
                                author: quote_json.author
                            }
                        } else {
                            return {
                                error: response.statusText
                            }
                        }
                    }
                }
            })
        </script>
    </body>
</html>
